{% extends "base.html" %}

{% block content %}
<div class="container py-5">
    <h1 class="text-center mb-4"><br><br>Real-time Color Detection</h1>
    
    <div class="row">
        <!-- Video Stream -->
        <div class="col-lg-8 mb-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <i class="fas fa-video"></i> Live Detection Feed
                </div>
                <div class="card-body text-center">
                    <img id="videoFeed" src="{{ url_for('video_feed') }}" 
                         class="img-fluid rounded" alt="Video Feed">
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="col-lg-4">
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <i class="fas fa-play-circle"></i> Detection Controls
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button id="startBtn" class="btn btn-success">
                            <i class="fas fa-play"></i> Start Detection
                        </button>
                        <button id="stopBtn" class="btn btn-danger">
                            <i class="fas fa-stop"></i> Stop Detection
                        </button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <i class="fas fa-palette"></i> Color Settings
                </div>
                <div class="card-body">
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input color-toggle" type="checkbox" 
                               id="blueToggle" checked data-color="blue">
                        <label class="form-check-label" for="blueToggle">
                            <span class="badge bg-primary">Blue Detection</span>
                        </label>
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input color-toggle" type="checkbox" 
                               id="greenToggle" checked data-color="green">
                        <label class="form-check-label" for="greenToggle">
                            <span class="badge bg-success">Green Detection</span>
                        </label>
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input color-toggle" type="checkbox" 
                               id="redToggle" checked data-color="red">
                        <label class="form-check-label" for="redToggle">
                            <span class="badge bg-danger">Red Detection</span>
                        </label>
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input color-toggle" type="checkbox" 
                               id="yellowToggle" checked data-color="yellow">
                        <label class="form-check-label" for="yellowToggle">
                            <span class="badge bg-warning text-dark">Yellow Detection</span>
                        </label>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input color-toggle" type="checkbox" 
                               id="purpleToggle" checked data-color="purple">
                        <label class="form-check-label" for="purpleToggle">
                            <span class="badge" style="background-color: purple; color: white;">Purple Detection</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const colorToggles = document.querySelectorAll('.color-toggle');
    
    startBtn.addEventListener('click', function() {
        fetch('/start_detection', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                alert('Detection started!');
            });
    });
    
    stopBtn.addEventListener('click', function() {
        fetch('/stop_detection', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                alert('Detection stopped!');
            });
    });
    
    colorToggles.forEach(toggle => {
        toggle.addEventListener('change', function() {
            const colorData = {};
            colorToggles.forEach(t => {
                colorData[t.dataset.color] = t.checked;
            });
            
            fetch('/update_colors', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(colorData)
            });
        });
    });
});
</script>
{% endblock %}